"use strict";(globalThis.webpackChunkfe_interview=globalThis.webpackChunkfe_interview||[]).push([[5644],{31832(e,n,s){s.d(n,{R:()=>r,x:()=>o});var t=s(30758);const a={},l=t.createContext(a);function r(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(l.Provider,{value:n},e.children)}},99502(e,n,s){s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>c});var t=s(86070),a=s(31832);const l={sidebar_position:1,title:"\u6838\u5fc3\u7ec4\u4ef6\u6307\u5357"},r="LangChain.js \u6838\u5fc3\u7ec4\u4ef6\u6307\u5357",o={id:"ai/app-development/langchain/components",title:"\u6838\u5fc3\u7ec4\u4ef6\u6307\u5357",description:"\u57fa\u4e8e LangChain.js v1.2.x",source:"@site/docs/ai/app-development/langchain/02-components.md",sourceDirName:"ai/app-development/langchain",slug:"/ai/app-development/langchain/components",permalink:"/FE-interview/docs/ai/app-development/langchain/components",draft:!1,unlisted:!1,editUrl:"https://github.com/gvray/FE-interview/tree/main/docs/ai/app-development/langchain/02-components.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"\u6838\u5fc3\u7ec4\u4ef6\u6307\u5357"},sidebar:"ai",previous:{title:"\u5165\u95e8\u6982\u5ff5",permalink:"/FE-interview/docs/ai/app-development/langchain/introduction"},next:{title:"7 \u5927\u6838\u5fc3\u7ec4\u4ef6\u8be6\u89e3",permalink:"/FE-interview/docs/ai/app-development/langchain/components1"}},i={},c=[{value:"\u76ee\u5f55",id:"\u76ee\u5f55",level:2},{value:"1. Models \u6a21\u578b",id:"1-models-\u6a21\u578b",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"ChatOpenAI",id:"chatopenai",level:3},{value:"\u517c\u5bb9 OpenAI API \u7684\u670d\u52a1",id:"\u517c\u5bb9-openai-api-\u7684\u670d\u52a1",level:3},{value:"2. Messages \u6d88\u606f",id:"2-messages-\u6d88\u606f",level:2},{value:"\u6d88\u606f\u7c7b\u578b",id:"\u6d88\u606f\u7c7b\u578b",level:3},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:3},{value:"Tool Calls",id:"tool-calls",level:3},{value:"3. Prompts \u63d0\u793a\u8bcd\u6a21\u677f",id:"3-prompts-\u63d0\u793a\u8bcd\u6a21\u677f",level:2},{value:"PromptTemplate",id:"prompttemplate",level:3},{value:"ChatPromptTemplate",id:"chatprompttemplate",level:3},{value:"FewShotPromptTemplate",id:"fewshotprompttemplate",level:3},{value:"4. Tools \u5de5\u5177",id:"4-tools-\u5de5\u5177",level:2},{value:"\u5b9a\u4e49\u5de5\u5177",id:"\u5b9a\u4e49\u5de5\u5177",level:3},{value:"\u7ed1\u5b9a\u5de5\u5177\u5230\u6a21\u578b",id:"\u7ed1\u5b9a\u5de5\u5177\u5230\u6a21\u578b",level:3},{value:"\u5de5\u5177\u8c03\u7528\u5faa\u73af",id:"\u5de5\u5177\u8c03\u7528\u5faa\u73af",level:3},{value:"5. Agents \u4ee3\u7406",id:"5-agents-\u4ee3\u7406",level:2},{value:"createAgent (LangChain v1.2+)",id:"createagent-langchain-v12",level:3},{value:"\u6d41\u5f0f\u8f93\u51fa",id:"\u6d41\u5f0f\u8f93\u51fa",level:3},{value:"6. Memory \u8bb0\u5fc6",id:"6-memory-\u8bb0\u5fc6",level:2},{value:"MemorySaver (LangGraph)",id:"memorysaver-langgraph",level:3},{value:"\u81ea\u5b9a\u4e49 Memory Store",id:"\u81ea\u5b9a\u4e49-memory-store",level:3},{value:"7. Middleware \u4e2d\u95f4\u4ef6",id:"7-middleware-\u4e2d\u95f4\u4ef6",level:2},{value:"createMiddleware",id:"createmiddleware",level:3},{value:"Tool Error Handling",id:"tool-error-handling",level:3},{value:"Trim Messages",id:"trim-messages",level:3},{value:"8. Structured Output \u7ed3\u6784\u5316\u8f93\u51fa",id:"8-structured-output-\u7ed3\u6784\u5316\u8f93\u51fa",level:2},{value:"\u4e24\u79cd\u7b56\u7565",id:"\u4e24\u79cd\u7b56\u7565",level:3},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b-1",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:3},{value:"\u5e38\u7528\u5305",id:"\u5e38\u7528\u5305",level:2},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"langchainjs-\u6838\u5fc3\u7ec4\u4ef6\u6307\u5357",children:"LangChain.js \u6838\u5fc3\u7ec4\u4ef6\u6307\u5357"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u57fa\u4e8e LangChain.js v1.2.x"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u76ee\u5f55",children:"\u76ee\u5f55"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#1-models-%E6%A8%A1%E5%9E%8B",children:"Models \u6a21\u578b"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#2-messages-%E6%B6%88%E6%81%AF",children:"Messages \u6d88\u606f"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#3-prompts-%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF",children:"Prompts \u63d0\u793a\u8bcd\u6a21\u677f"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#4-tools-%E5%B7%A5%E5%85%B7",children:"Tools \u5de5\u5177"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#5-agents-%E4%BB%A3%E7%90%86",children:"Agents \u4ee3\u7406"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#6-memory-%E8%AE%B0%E5%BF%86",children:"Memory \u8bb0\u5fc6"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#7-middleware-%E4%B8%AD%E9%97%B4%E4%BB%B6",children:"Middleware \u4e2d\u95f4\u4ef6"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"1-models-\u6a21\u578b",children:"1. Models \u6a21\u578b"}),"\n",(0,t.jsx)(n.h3,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm add @langchain/openai @langchain/core\n"})}),"\n",(0,t.jsx)(n.h3,{id:"chatopenai",children:"ChatOpenAI"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { ChatOpenAI } from "@langchain/openai";\n\nconst model = new ChatOpenAI({\n  model: "gpt-4o",           // \u6a21\u578b\u540d\u79f0\n  temperature: 0.7,          // \u521b\u9020\u6027 (0-1)\n  maxTokens: 2000,           // \u6700\u5927\u8f93\u51fa token\n  apiKey: "sk-xxx",          // API Key\n  configuration: {\n    baseURL: "https://api.openai.com/v1",  // \u81ea\u5b9a\u4e49\u7aef\u70b9\n  },\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u517c\u5bb9-openai-api-\u7684\u670d\u52a1",children:"\u517c\u5bb9 OpenAI API \u7684\u670d\u52a1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// \u963f\u91cc\u4e91\u767e\u70bc\nconst model = new ChatOpenAI({\n  model: "qwen-turbo",\n  apiKey: process.env.API_KEY,\n  configuration: {\n    baseURL: "https://dashscope.aliyuncs.com/compatible-mode/v1",\n  },\n});\n\n// Ollama \u672c\u5730\nconst model = new ChatOpenAI({\n  model: "llama3",\n  configuration: {\n    baseURL: "http://localhost:11434/v1",\n  },\n});\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"2-messages-\u6d88\u606f",children:"2. Messages \u6d88\u606f"}),"\n",(0,t.jsx)(n.h3,{id:"\u6d88\u606f\u7c7b\u578b",children:"\u6d88\u606f\u7c7b\u578b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import {\n  HumanMessage,      // \u7528\u6237\u6d88\u606f\n  AIMessage,         // AI \u56de\u590d\n  SystemMessage,     // \u7cfb\u7edf\u63d0\u793a\n  ToolMessage,       // \u5de5\u5177\u8fd4\u56de\n} from "@langchain/core/messages";\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u4f7f\u7528\u793a\u4f8b",children:"\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const messages = [\n  new SystemMessage("\u4f60\u662f\u4e00\u4e2a\u52a9\u624b"),\n  new HumanMessage("\u4f60\u597d"),\n  new AIMessage("\u4f60\u597d\uff01\u6709\u4ec0\u4e48\u53ef\u4ee5\u5e2e\u4f60\u7684\uff1f"),\n  new HumanMessage("\u4eca\u5929\u5929\u6c14\u600e\u4e48\u6837"),\n];\n\nconst response = await model.invoke(messages);\nconsole.log(response.content);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"tool-calls",children:"Tool Calls"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// AI \u8fd4\u56de\u7684 tool_calls\nif (response.tool_calls && response.tool_calls.length > 0) {\n  for (const toolCall of response.tool_calls) {\n    console.log(toolCall.name);  // \u5de5\u5177\u540d\n    console.log(toolCall.args);  // \u53c2\u6570\n    console.log(toolCall.id);    // \u8c03\u7528 ID\n  }\n}\n\n// \u8fd4\u56de\u5de5\u5177\u7ed3\u679c\nconst toolMessage = new ToolMessage({\n  tool_call_id: toolCall.id,\n  content: "\u5de5\u5177\u6267\u884c\u7ed3\u679c",\n});\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"3-prompts-\u63d0\u793a\u8bcd\u6a21\u677f",children:"3. Prompts \u63d0\u793a\u8bcd\u6a21\u677f"}),"\n",(0,t.jsx)(n.h3,{id:"prompttemplate",children:"PromptTemplate"}),"\n",(0,t.jsx)(n.p,{children:"\u57fa\u7840\u53d8\u91cf\u63d2\u503c\u6a21\u677f\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { PromptTemplate } from "@langchain/core/prompts";\n\nconst template = PromptTemplate.fromTemplate(\n  `\u8bf7\u5c06\u4ee5\u4e0b\u6587\u672c\u7ffb\u8bd1\u6210{language}\uff1a\n\n{text}`\n);\n\nconst prompt = await template.format({\n  language: "\u82f1\u6587",\n  text: "\u4f60\u597d\u4e16\u754c",\n});\n// \u8f93\u51fa: "\u8bf7\u5c06\u4ee5\u4e0b\u6587\u672c\u7ffb\u8bd1\u6210\u82f1\u6587\uff1a\\n\\n\u4f60\u597d\u4e16\u754c"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"chatprompttemplate",children:"ChatPromptTemplate"}),"\n",(0,t.jsx)(n.p,{children:"\u7528\u4e8e\u6784\u5efa\u5bf9\u8bdd\u6d88\u606f\u5e8f\u5217\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { ChatPromptTemplate, MessagesPlaceholder } from "@langchain/core/prompts";\n\nconst chatTemplate = ChatPromptTemplate.fromMessages([\n  ["system", "\u4f60\u662f\u4e00\u4e2a{role}"],\n  new MessagesPlaceholder("history"),  // \u5386\u53f2\u6d88\u606f\u5360\u4f4d\u7b26\n  ["human", "{input}"],\n]);\n\nconst messages = await chatTemplate.formatMessages({\n  role: "\u7ffb\u8bd1\u52a9\u624b",\n  history: [\n    new HumanMessage("\u4f60\u597d"),\n    new AIMessage("Hello!"),\n  ],\n  input: "\u8c22\u8c22",\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"fewshotprompttemplate",children:"FewShotPromptTemplate"}),"\n",(0,t.jsx)(n.p,{children:"\u5e26\u793a\u4f8b\u7684\u63d0\u793a\u6a21\u677f\uff0c\u63d0\u5347\u8f93\u51fa\u8d28\u91cf\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { FewShotPromptTemplate, PromptTemplate } from "@langchain/core/prompts";\n\nconst examplePrompt = PromptTemplate.fromTemplate(\n  `\u8f93\u5165: {input}\n\u8f93\u51fa: {output}`\n);\n\nconst examples = [\n  { input: "happy", output: "\u5f00\u5fc3" },\n  { input: "sad", output: "\u60b2\u4f24" },\n  { input: "angry", output: "\u6124\u6012" },\n];\n\nconst fewShotTemplate = new FewShotPromptTemplate({\n  examples,\n  examplePrompt,\n  prefix: "\u5c06\u82f1\u6587\u60c5\u611f\u8bcd\u7ffb\u8bd1\u6210\u4e2d\u6587\uff1a",\n  suffix: "\u8f93\u5165: {word}\\n\u8f93\u51fa:",\n  inputVariables: ["word"],\n});\n\nconst prompt = await fewShotTemplate.format({ word: "excited" });\n// \u8f93\u51fa\u5305\u542b\u793a\u4f8b\uff0c\u5f15\u5bfc\u6a21\u578b\u8f93\u51fa\u683c\u5f0f\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"4-tools-\u5de5\u5177",children:"4. Tools \u5de5\u5177"}),"\n",(0,t.jsx)(n.h3,{id:"\u5b9a\u4e49\u5de5\u5177",children:"\u5b9a\u4e49\u5de5\u5177"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { tool } from "@langchain/core/tools";\nimport { z } from "zod";\n\nconst myTool = tool(\n  async (input) => {\n    // \u5de5\u5177\u903b\u8f91\n    return `\u7ed3\u679c: ${input.param}`;\n  },\n  {\n    name: "tool_name",           // \u552f\u4e00\u6807\u8bc6\n    description: "\u5de5\u5177\u63cf\u8ff0",      // LLM \u6839\u636e\u6b64\u51b3\u5b9a\u662f\u5426\u8c03\u7528\n    schema: z.object({           // Zod schema \u5b9a\u4e49\u53c2\u6570\n      param: z.string().describe("\u53c2\u6570\u8bf4\u660e"),\n    }),\n  }\n);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u7ed1\u5b9a\u5de5\u5177\u5230\u6a21\u578b",children:"\u7ed1\u5b9a\u5de5\u5177\u5230\u6a21\u578b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const tools = [calculator, getWeather, searchWeb];\nconst modelWithTools = model.bindTools(tools);\n\nconst response = await modelWithTools.invoke(messages);\n\n// \u68c0\u67e5\u662f\u5426\u6709\u5de5\u5177\u8c03\u7528\nif (response.tool_calls?.length > 0) {\n  // \u6267\u884c\u5de5\u5177...\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u5de5\u5177\u8c03\u7528\u5faa\u73af",children:"\u5de5\u5177\u8c03\u7528\u5faa\u73af"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"async function runAgentLoop(messages, model, tools) {\n  let currentMessages = [...messages];\n  const maxIterations = 5;\n\n  for (let i = 0; i < maxIterations; i++) {\n    const response = await model.invoke(currentMessages);\n    currentMessages.push(response);\n\n    if (response.tool_calls?.length > 0) {\n      // \u6267\u884c\u6bcf\u4e2a\u5de5\u5177\u8c03\u7528\n      for (const toolCall of response.tool_calls) {\n        const tool = tools.find(t => t.name === toolCall.name);\n        const result = await tool.invoke(toolCall.args);\n        \n        currentMessages.push(new ToolMessage({\n          tool_call_id: toolCall.id,\n          content: result,\n        }));\n      }\n    } else {\n      // \u65e0\u5de5\u5177\u8c03\u7528\uff0c\u8fd4\u56de\u6700\u7ec8\u54cd\u5e94\n      return response.content;\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"5-agents-\u4ee3\u7406",children:"5. Agents \u4ee3\u7406"}),"\n",(0,t.jsx)(n.h3,{id:"createagent-langchain-v12",children:"createAgent (LangChain v1.2+)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { createAgent } from "langchain";\n\nconst agent = createAgent({\n  model: "gpt-4o",           // \u6216 ChatOpenAI \u5b9e\u4f8b\n  tools: [tool1, tool2],\n  systemPrompt: "\u4f60\u662f\u4e00\u4e2a\u52a9\u624b",\n});\n\nconst result = await agent.invoke({\n  messages: [{ role: "user", content: "\u4f60\u597d" }],\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u6d41\u5f0f\u8f93\u51fa",children:"\u6d41\u5f0f\u8f93\u51fa"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const stream = await agent.stream(\n  { messages: [{ role: "user", content: "\u641c\u7d22\u65b0\u95fb" }] },\n  { streamMode: "values" }\n);\n\nfor await (const chunk of stream) {\n  const lastMsg = chunk.messages.at(-1);\n  if (lastMsg?.content) {\n    console.log(lastMsg.content);\n  }\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"6-memory-\u8bb0\u5fc6",children:"6. Memory \u8bb0\u5fc6"}),"\n",(0,t.jsx)(n.h3,{id:"memorysaver-langgraph",children:"MemorySaver (LangGraph)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { MemorySaver } from "@langchain/langgraph";\n\nconst checkpointer = new MemorySaver();\n\nconst agent = createAgent({\n  model: "gpt-4o",\n  tools: [],\n  checkpointer,  // \u542f\u7528\u8bb0\u5fc6\n});\n\n// \u4f7f\u7528 thread_id \u8ffd\u8e2a\u4f1a\u8bdd\nawait agent.invoke(\n  { messages: [{ role: "user", content: "\u6211\u53eb\u5c0f\u660e" }] },\n  { configurable: { thread_id: "user_123" } }\n);\n\n// \u540e\u7eed\u5bf9\u8bdd\uff0c\u540c\u4e00 thread_id \u4f1a\u8bb0\u4f4f\u4e0a\u4e0b\u6587\nawait agent.invoke(\n  { messages: [{ role: "user", content: "\u6211\u53eb\u4ec0\u4e48\uff1f" }] },\n  { configurable: { thread_id: "user_123" } }\n);\n// AI \u56de\u590d: \u4f60\u53eb\u5c0f\u660e\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49-memory-store",children:"\u81ea\u5b9a\u4e49 Memory Store"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"class InMemoryStore {\n  private store = new Map();\n\n  get(threadId: string) {\n    return this.store.get(threadId)?.messages || [];\n  }\n\n  set(threadId: string, messages: BaseMessage[]) {\n    this.store.set(threadId, {\n      messages: this.trimMessages(messages),\n      updatedAt: new Date(),\n    });\n  }\n\n  // \u81ea\u52a8\u88c1\u526a\u65e7\u6d88\u606f\n  private trimMessages(messages: BaseMessage[]) {\n    const maxMessages = 20;\n    if (messages.length <= maxMessages) return messages;\n    return [messages[0], ...messages.slice(-maxMessages + 1)];\n  }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"7-middleware-\u4e2d\u95f4\u4ef6",children:"7. Middleware \u4e2d\u95f4\u4ef6"}),"\n",(0,t.jsx)(n.h3,{id:"createmiddleware",children:"createMiddleware"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { createMiddleware } from "langchain";\n\nconst loggingMiddleware = createMiddleware({\n  name: "Logging",\n  beforeModel: (state) => {\n    console.log("Before model:", state.messages.length);\n  },\n  afterModel: (state) => {\n    console.log("After model:", state.messages.at(-1)?.content);\n  },\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"tool-error-handling",children:"Tool Error Handling"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const toolErrorMiddleware = createMiddleware({\n  name: "ToolErrorHandler",\n  wrapToolCall: async (toolCall, toolFn) => {\n    try {\n      return await toolFn(toolCall);\n    } catch (error) {\n      console.error(`Tool ${toolCall.name} failed:`, error);\n      return new ToolMessage({\n        tool_call_id: toolCall.id,\n        content: `Error: ${error.message}`,\n      });\n    }\n  },\n});\n\nconst agent = createAgent({\n  model: "gpt-4o",\n  tools: [myTool],\n  middleware: [toolErrorMiddleware],\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"trim-messages",children:"Trim Messages"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { RemoveMessage } from "@langchain/core/messages";\nimport { REMOVE_ALL_MESSAGES } from "@langchain/langgraph";\n\nconst trimMiddleware = createMiddleware({\n  name: "TrimMessages",\n  beforeModel: (state) => {\n    if (state.messages.length <= 10) return;\n    \n    const systemMsg = state.messages[0];\n    const recent = state.messages.slice(-8);\n    \n    return {\n      messages: [\n        new RemoveMessage({ id: REMOVE_ALL_MESSAGES }),\n        systemMsg,\n        ...recent,\n      ],\n    };\n  },\n});\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"8-structured-output-\u7ed3\u6784\u5316\u8f93\u51fa",children:"8. Structured Output \u7ed3\u6784\u5316\u8f93\u51fa"}),"\n",(0,t.jsx)(n.p,{children:"\u5f3a\u5236\u6a21\u578b\u8fd4\u56de\u7b26\u5408 Schema \u7684\u7ed3\u6784\u5316 JSON\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u4e24\u79cd\u7b56\u7565",children:"\u4e24\u79cd\u7b56\u7565"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { createAgent, toolStrategy, providerStrategy } from "langchain";\nimport { z } from "zod";\n\nconst schema = z.object({\n  name: z.string(),\n  age: z.number(),\n});\n\n// \u65b9\u5f0f1: Provider Strategy\uff08\u6a21\u578b\u539f\u751f\u652f\u6301\uff09\nconst agent1 = createAgent({\n  model: "gpt-4o",\n  responseFormat: providerStrategy(schema),\n});\n\n// \u65b9\u5f0f2: Tool Strategy\uff08\u901a\u8fc7\u5de5\u5177\u8c03\u7528\u5b9e\u73b0\uff09\nconst agent2 = createAgent({\n  model: "gpt-4o",\n  responseFormat: toolStrategy(schema),\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u4f7f\u7528\u793a\u4f8b-1",children:"\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const ContactSchema = z.object({\n  name: z.string().describe("\u59d3\u540d"),\n  email: z.string().optional().describe("\u90ae\u7bb1"),\n  phone: z.string().optional().describe("\u7535\u8bdd"),\n});\n\nconst agent = createAgent({\n  model: createLLM(),\n  tools: [],\n  responseFormat: toolStrategy(ContactSchema),\n});\n\nconst result = await agent.invoke({\n  messages: [{ role: "user", content: "\u63d0\u53d6: \u5f20\u4e09, zhang@example.com" }],\n});\n\nconsole.log(result.structuredResponse);\n// { name: "\u5f20\u4e09", email: "zhang@example.com" }\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const agent = createAgent({\n  model: createLLM(),\n  responseFormat: toolStrategy(schema, {\n    handleError: true,  // \u81ea\u52a8\u91cd\u8bd5\uff08\u9ed8\u8ba4\uff09\n    // handleError: false,  // \u4e0d\u91cd\u8bd5\uff0c\u629b\u51fa\u5f02\u5e38\n    // handleError: (err) => `\u8bf7\u4fee\u6b63: ${err.message}`,  // \u81ea\u5b9a\u4e49\n  }),\n});\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u5e38\u7528\u5305",children:"\u5e38\u7528\u5305"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u5305\u540d"}),(0,t.jsx)(n.th,{children:"\u7528\u9014"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"langchain"})}),(0,t.jsx)(n.td,{children:"\u6838\u5fc3\u5e93\uff0ccreateAgent \u7b49"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"@langchain/core"})}),(0,t.jsx)(n.td,{children:"\u6d88\u606f\u3001\u5de5\u5177\u3001\u63d0\u793a\u8bcd\u57fa\u7840\u7c7b"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"@langchain/openai"})}),(0,t.jsx)(n.td,{children:"OpenAI / \u517c\u5bb9 API \u6a21\u578b"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"@langchain/langgraph"})}),(0,t.jsx)(n.td,{children:"\u72b6\u6001\u56fe\u3001\u8bb0\u5fc6\u3001Checkpointer"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"zod"})}),(0,t.jsx)(n.td,{children:"Schema \u9a8c\u8bc1\uff08\u5de5\u5177\u53c2\u6570\uff09"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u53c2\u8003\u94fe\u63a5",children:"\u53c2\u8003\u94fe\u63a5"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.langchain.com/oss/javascript",children:"LangChain.js \u5b98\u65b9\u6587\u6863"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.langchain.com/oss/javascript/langchain/tools",children:"Tools \u6587\u6863"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.langchain.com/oss/javascript/langchain/agents",children:"Agents \u6587\u6863"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.langchain.com/oss/javascript/langchain/short-term-memory",children:"Short-term Memory"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.langchain.com/oss/javascript/langchain/middleware",children:"Middleware"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);